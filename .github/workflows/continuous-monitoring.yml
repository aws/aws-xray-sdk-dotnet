name: Continuous monitoring of distribution channels

on:
    workflow_dispatch:
    schedule:
      - cron: '0 */1 * * *'

jobs:
    smoke-tests:
        name: Run smoke tests
        runs-on: ${{ matrix.os }}
        
        strategy:
            fail-fast: false
            matrix:
                os: [windows-latest,ubuntu-latest]
                version: [net452,netcoreapp2.0]
                exclude:
                  - os: ubuntu-latest
                    version: net452

        steps:
          - name: Checkout repository
            uses: actions/checkout@v2

          - name: Install dependencies
            run: dotnet restore sdk/test/SmokeTests/AWSXRayRecorder.SmokeTests.csproj

          - name: Build tests
            run: dotnet build sdk/test/SmokeTests/AWSXRayRecorder.SmokeTests.csproj --configuration Release --no-restore

          - name: Run tests
            run: dotnet test sdk/test/SmokeTests/bin/Release/${{matrix.version}}/AWSXRayRecorder.SmokeTests.dll
